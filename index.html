<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KANTANZA Forum</title>
  <style>
    :root{
      --bg:#0f1115;
      --card:#151922;
      --ink:#e8ebf1;
      --muted:#a9b0bf;
      --accent:#69bffc;
      --line:#2b3240;
      --danger:#ff6b6b;
      --ok:#7fdc82;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:Calibri, Arial, Helvetica, sans-serif;}

    /* Genel iskelet */
    .container{max-width:1200px;margin:0 auto;padding:16px;display:grid;grid-template-columns:260px 1fr 260px;gap:16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .pad{padding:16px}
    .row{display:flex;align-items:center;gap:10px}
    .between{display:flex;align-items:center;justify-content:space-between}
    .line{height:1px;background:var(--line);}
    .thick-line{height:4px;background:var(--line);border-radius:2px}
    a{color:var(--ink);text-decoration:none}
    button{background:var(--accent);color:#0b0d12;border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;color:var(--ink);border:1px solid var(--line)}
    button.danger{background:var(--danger);color:white}
    button:disabled{opacity:.6;cursor:not-allowed}
    input, textarea{width:100%;background:#0f131a;border:1px solid var(--line);border-radius:10px;color:var(--ink);padding:10px}
    label{display:block;margin:10px 0 6px}

    /* BaÅŸlÄ±k alanÄ± */
    header.card{grid-column:1 / -1;}
    .brand{font-family:'Arial Black', Arial, Helvetica, sans-serif;font-size:18pt;font-weight:900;letter-spacing:.5px;cursor:pointer}
    .brand-underline{height:3px;background:var(--ink);width:max(140px, 14ch);border-radius:3px;margin-top:6px}
    .auth-actions{gap:10px}
    
    /* BaÅŸlÄ±k alanÄ± - ORTALAMA Ä°Ã‡Ä°N */
    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }

    .brand-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .auth-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Admin butonu iÃ§in stil */
    #adminButton {
      display: none;
      margin-right: 10px;
    }

    /* Film ve Dizi GÃ¶rselleri */
    .media-image-container {
      width: 100%;
      margin: 12px 0;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--line);
    }
    
    .media-image {
      width: 100%;
      height: auto;
      display: block;
    }
    
    .media-placeholder {
      width: 100%;
      height: 180px;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: var(--muted);
    }
    
    .media-placeholder i {
      font-size: 48px;
      margin-bottom: 8px;
    }

    /* Mobil iÃ§in responsive */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 12px;
      }
      
      .auth-actions {
        width: 100%;
        justify-content: center;
      }
      
      .media-image-container {
        margin: 8px 0;
      }
    }

    /* Konular listesi */
    .topics .title{font-family:Calibri, Arial, Helvetica, sans-serif;font-weight:700;font-size:16pt}
    .topic-item{padding:12px 8px;cursor:pointer}
    .topic-item:hover{background:rgba(255,255,255,0.05)}
    .topic-item + .topic-item{border-top:1px solid var(--line)}
    .topic-id{font-weight:700;color:var(--muted);margin-right:8px}
    .topic-head{font-weight:700}
    .topic-desc{color:var(--muted);font-size:14px;margin-top:4px}
    .topic-user{color:var(--muted);font-size:12px;margin-top:4px}

    /* Sol yan: film & yemek */
    .sidebar h3{margin:0 0 8px}
    .badge{display:inline-block;background:var(--line);padding:2px 8px;border-radius:999px;font-size:12px;color:var(--muted)}
    
    /* Dizi Ã¶nerileri */
    .series-info {
      margin-top: 8px;
    }
    
    .series-info p {
      margin: 6px 0;
      font-size: 14px;
    }
    
    .series-rating {
      color: var(--accent);
      font-weight: bold;
    }
    
    .series-seasons {
      color: var(--ok);
    }
    
    .series-best-episode {
      font-style: italic;
      color: var(--muted);
    }
    
    /* Yemek tarifleri */
    .recipe-item{margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid var(--line)}
    .recipe-item:last-child{margin-bottom:0;border-bottom:none}
    .recipe-title{font-weight:bold;margin-bottom:6px}
    .recipe-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:14px;color:var(--muted)}
    .recipe-ingredients{font-size:14px;margin-bottom:10px;color:var(--muted)}
    .recipe-button{width:100%;margin-top:8px}

    /* SaÄŸ yan: kombin */
    .outfit li{margin-bottom:6px}

    /* GÃ¼nÃ¼n Ä°ngilizce Kelimesi */
    .word-of-the-day {margin-top: 16px;}
    .english-word {font-size: 24px; font-weight: bold; color: var(--accent); margin: 8px 0;}
    .word-pronunciation {color: var(--muted); font-style: italic; margin-bottom: 8px;}
    .word-meaning {margin-bottom: 8px;}
    .word-example {border-left: 3px solid var(--accent); padding-left: 12px; color: var(--muted); font-style: italic;}

    /* GÃ¼nlÃ¼k Kombin AlanÄ± */
    .daily-outfit {
      text-align: center;
      margin-bottom: 16px;
    }
    
    .outfit-image-container {
      width: 100%;
      height: 300px;
      border: 2px solid var(--line);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      overflow: hidden;
      background: var(--bg);
    }
    
    .outfit-image {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    
    .outfit-placeholder {
      color: var(--muted);
      text-align: center;
      padding: 20px;
    }
    
    .outfit-placeholder i {
      font-size: 48px;
      margin-bottom: 12px;
      display: block;
    }
    
    .outfit-info {
      background: var(--bg);
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
    }
    
    .outfit-info h4 {
      margin: 0 0 8px 0;
      color: var(--accent);
    }
    
    .outfit-info ul {
      margin: 0;
      padding-left: 20px;
      text-align: left;
    }
    
    .outfit-info li {
      margin-bottom: 6px;
    }

    /* Modallar */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:40}
    .modal.show{display:flex}
    .modal .sheet{width:min(560px, 96vw);background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 20px 50px rgba(0,0,0,.45)}
    .modal .sheet .head{padding:16px 16px 0}
    .modal .sheet .body{padding:16px}
    .modal .sheet .foot{padding:0 16px 16px;display:flex;gap:8px;justify-content:flex-end}
    .label-12-calibri{font-family:Calibri, Arial, Helvetica, sans-serif;font-weight:700;font-size:12pt}
    .label-12-calibri-normal{font-family:Calibri, Arial, Helvetica, sans-serif;font-size:12pt}
    .topic-view-title{font-family:"Comic Sans MS", "Comic Sans", cursive;font-weight:700;font-size:18pt}
    
    .link{color:var(--accent)}
    
    /* Konu detay sayfasÄ± */
    .comment-item{padding:12px 0;border-bottom:1px solid var(--line)}
    .comment-item:last-child{border-bottom:none}
    
    @media (max-width:900px){
      .container{grid-template-columns:1fr; padding:12px}
      
      .media-image-container {
        max-width: 100%;
        margin: 10px auto;
      }
    }
  </style>
</head>
<body>
 <!-- ÃœST BÃ–LÃœM: Marka ve Auth -->
<header class="card pad">
  <div class="header-content">
    <div class="brand-container">
      <div class="brand" id="brandTitle">KANTANZA</div>
      <div class="brand-underline"></div>
    </div>
    <div class="auth-actions">
      <!-- Admin Panel Butonu -->
      <div id="adminButton" style="display: none;">
        <button id="btnAdminPanel" class="ghost">Admin Paneli</button>
      </div>
      
      <!-- GiriÅŸ yapmamÄ±ÅŸ kullanÄ±cÄ± butonlarÄ± -->
      <div id="guestButtons">
        <button id="btnLogin">GiriÅŸ yap</button>
        <button class="ghost" id="btnSignup">Ãœye ol</button>
      </div>
      
      <!-- GiriÅŸ yapmÄ±ÅŸ kullanÄ±cÄ± butonu -->
      <div id="userButton" style="display: none;">
        <button id="btnProfileHeader">Profilim</button>
        <button id="btnLogout" class="danger">Ã‡Ä±kÄ±ÅŸ yap</button>
      </div>
    </div>
  </div>
  <div class="line" style="margin-top:12px"></div>
</header>

  <main class="container">
    <!-- Sol: Film & Dizi & Yemek -->
    <aside class="card pad sidebar">
      <!-- FÄ°LM Ã–NERÄ°SÄ° -->
      <h3>BugÃ¼nkÃ¼ Film Tavsiyemiz</h3>
      <div class="line" style="margin:8px 0"></div>
      
      <!-- Film GÃ¶rseli -->
      <div class="media-image-container">
        <div class="media-placeholder">
          <i>ğŸ¬</i>
          <div>Film GÃ¶rseli</div>
        </div>
        <!-- <img class="media-image" src="film-gorseli.jpg" alt="KaranlÄ±ÄŸÄ±n OrmanÄ±"> -->
      </div>
      
      <div class="row" style="flex-wrap:wrap;gap:6px">
        <span class="badge">IMDb: 8.6</span>
        <span class="badge">Rotten Tomatoes: 94%</span>
        <span class="badge">+18 deÄŸil</span>
        <span class="badge">Macera â€¢ Korku â€¢ Gizem</span>
      </div>
      <p><strong>Film:</strong> "KaranlÄ±ÄŸÄ±n OrmanÄ±"</p>
      <p><strong>Oyuncular:</strong> A. Kaya, B. Demir, C. Ã–z</p>
      <p><strong>KÄ±saca:</strong> IssÄ±z bir daÄŸ kasabasÄ±nda kaybolan kampÃ§Ä±lar, eski bir efsanenin peÅŸinden sÃ¼rÃ¼klenir.</p>
      
      <div class="line" style="margin:16px 0"></div>
      
      <!-- DÄ°ZÄ° Ã–NERÄ°LERÄ° -->
      <h3>Dizi Ã–nerileri</h3>
      <div class="line" style="margin:8px 0"></div>
      
      <!-- Dizi GÃ¶rseli -->
      <div class="media-image-container">
        <div class="media-placeholder">
          <i>ğŸ“º</i>
          <div>Dizi GÃ¶rseli</div>
        </div>
        <!-- <img class="media-image" src="dizi-gorseli.jpg" alt="ZamanÄ±n Ã–tesinde"> -->
      </div>
      
      <div class="series-info">
        <p><strong>Dizi:</strong> "ZamanÄ±n Ã–tesinde"</p>
        <p><strong class="series-rating">IMDb: 8.8/10</strong></p>
        <p><strong>Konu:</strong> Gelecekten gelen bir zaman yolcusunun, tarihi olaylarÄ± deÄŸiÅŸtirmeye Ã§alÄ±ÅŸan bir organizasyonla mÃ¼cadelesi.</p>
        <p><strong class="series-seasons">Sezon SayÄ±sÄ±:</strong> 3 sezon</p>
        <p><strong class="series-best-episode">En Sevilen BÃ¶lÃ¼m:</strong> "Sonsuzluk YolculuÄŸu" (3. Sezon 8. BÃ¶lÃ¼m)</p>
      </div>
      
      <div class="line" style="margin:16px 0"></div>
      
      <!-- YEMEK TARÄ°FLERÄ° BÃ–LÃœMÃœ -->
      <h3>Basit Yemek Tarifleri</h3>
      <div id="recipesList"></div>
    </aside>
    
    <!-- Orta: Konular -->
    <section class="card pad topics" id="view-home">
      <div class="between">
        <div class="title">KONULAR</div>
        <button id="btnNewTopic">Konu AÃ§</button>
      </div>
      <div class="line" style="margin-top:8px"></div>
      <div id="topicsList" style="margin-top:8px"></div>
    </section>
    
    <!-- SaÄŸ: GÃ¼nlÃ¼k Kombin ve GÃ¼nÃ¼n Ä°ngilizce Kelimesi -->
    <div>
      <!-- GÃœNLÃœK KOMBÄ°N ALANI -->
      <aside class="card pad daily-outfit">
        <h3>GÃ¼nlÃ¼k Kombin</h3>
        <div class="line" style="margin:8px 0"></div>
        
        <div class="outfit-image-container" id="outfitImageContainer">
          <div class="outfit-placeholder" id="outfitPlaceholder">
            <i>ğŸ‘—</i>
            <div>Admin panelinden kombin gÃ¶rseli yÃ¼klenmemiÅŸ</div>
            <small style="margin-top: 8px; display: block;">GÃ¶rsel yÃ¼klemek iÃ§in admin paneline gidin</small>
          </div>
          <img class="outfit-image" id="outfitImage" src="" alt="GÃ¼nlÃ¼k Kombin" style="display: none;">
        </div>
        
        <div class="outfit-info" id="outfitDetails">
          <h4>BugÃ¼nkÃ¼ Kombin DetaylarÄ±</h4>
          <ul>
            <li><strong>Ãœst:</strong> <span id="outfitTop">-</span></li>
            <li><strong>Alt:</strong> <span id="outfitBottom">-</span></li>
            <li><strong>AyakkabÄ±:</strong> <span id="outfitShoes">-</span></li>
            <li><strong>Aksesuar:</strong> <span id="outfitAccessory">-</span></li>
          </ul>
        </div>
        
        <button id="btnManageOutfits" class="ghost" style="margin-top: 12px; width: 100%;">
          Kombinleri YÃ¶net (Admin)
        </button>
      </aside>
      
      <!-- GÃœNÃœN Ä°NGÄ°LÄ°ZCE KELÄ°MESÄ° BÃ–LÃœMÃœ -->
      <aside class="card pad word-of-the-day">
        <h3>GÃ¼nÃ¼n Ä°ngilizce Kelimesi</h3>
        <div class="line" style="margin:8px 0"></div>
        <div class="english-word" id="englishWord">Serendipity</div>
        <div class="word-pronunciation" id="wordPronunciation">/ËŒser.É™nËˆdÉªp.É™.ti/</div>
        <div class="word-meaning" id="wordMeaning">Mutlu tesadÃ¼f; beklenmedik ve hoÅŸ sÃ¼rprizlerle karÅŸÄ±laÅŸma</div>
        <div class="word-example" id="wordExample">"Finding this beautiful cafe was a real serendipity." (Bu gÃ¼zel kafeyi bulmak gerÃ§ek bir mutlu tesadÃ¼ftÃ¼.)</div>
      </aside>
    </div>
  </main>

  <!-- Konu Detay GÃ¶rÃ¼nÃ¼mÃ¼ (SPA) -->
  <section class="container" id="view-topic" style="display:none">
    <div class="card pad" style="grid-column:1 / -1">
      <a class="link" href="#" id="backToHome">â† Geri dÃ¶n</a>
    </div>
    <div class="card pad" style="grid-column:1 / -1">
      <div id="topicDetail"></div>
    </div>
  </section>

  <!-- Modals (konu, yorum, login, signup, yemek) -->
  <div class="modal" id="modalTopic">
    <div class="sheet">
      <div class="head"><div class="label-12-calibri">KONU BAÅLIÄI</div></div>
      <div class="body">
        <div class="line" style="margin:6px 0 12px"></div>
        <input id="inpTopicTitle" maxlength="15" placeholder="BaÅŸlÄ±k (max 15)" />
        <label class="label-12-calibri-normal" style="margin-top:14px">KONU</label>
        <textarea id="inpTopicBody" rows="5" maxlength="250" placeholder="AÃ§Ä±klama (max 250)"></textarea>
        <small style="color:var(--muted)">* Ã–zel karakterlere izin verilmez. Harf ve rakamlar metin olarak kabul edilir.</small>
      </div>
      <div class="foot">
        <button class="ghost" data-close="#modalTopic">Ä°ptal</button>
        <button id="btnSaveTopic">Konuyu Kaydet</button>
      </div>
    </div>
  </div>
  
  <div class="modal" id="modalComment">
    <div class="sheet">
      <div class="head"><div class="label-12-calibri">yorumum</div></div>
      <div class="body">
        <textarea id="inpComment" rows="5" maxlength="250" placeholder="Yorum (max 250)"></textarea>
      </div>
      <div class="foot">
        <button class="ghost" data-close="#modalComment">Ä°ptal</button>
        <button id="btnSendComment">GÃ¶nder</button>
      </div>
    </div>
  </div>
  
  <div class="modal" id="modalLogin">
    <div class="sheet">
      <div class="head"><div class="label-12-calibri">KullanÄ±cÄ± adÄ±</div></div>
      <div class="body">
        <input id="loginUser" placeholder="KullanÄ±cÄ± adÄ±" />
        <div class="line" style="margin:8px 0"></div>
        <label class="label-12-calibri-normal">Åifre</label>
        <input id="loginPass" type="password" placeholder="Åifre" />
        <div class="line" style="margin:8px 0"></div>
      </div>
      <div class="foot">
        <button class="ghost" data-close="#modalLogin">Kapat</button>
        <button id="btnDoLogin">GiriÅŸ yap</button>
      </div>
    </div>
  </div>
  
  <div class="modal" id="modalSignup">
    <div class="sheet">
      <div class="head"><div class="label-12-calibri">Ãœyelik</div></div>
      <div class="body">
        <label class="label-12-calibri-normal">Mail</label>
        <input id="suMail" type="email" placeholder="ornek@site.com" />
        <div class="line" style="margin:8px 0"></div>
        <label class="label-12-calibri-normal">KullanÄ±cÄ± adÄ±</label>
        <input id="suUser" placeholder="KullanÄ±cÄ± adÄ±" />
        <div class="line" style="margin:8px 0"></div>
        <label class="label-12-calibri-normal">Åifre</label>
        <input id="suPass" type="password" placeholder="Åifre (min 5 karakter, 1 bÃ¼yÃ¼k harf, 1 sayÄ±)" />
        <label class="label-12-calibri-normal" style="margin-top:10px">Åifre onay</label>
        <input id="suPass2" type="password" placeholder="Åifre tekrar" />
        <div class="line" style="margin:8px 0"></div>
        <small style="color:var(--muted)">* Åifre en az 5 karakter, 1 bÃ¼yÃ¼k harf ve 1 sayÄ± iÃ§ermelidir.</small>
      </div>
      <div class="foot">
        <button class="ghost" data-close="#modalSignup">Kapat</button>
        <button id="btnDoSignup">Ãœye ol</button>
      </div>
    </div>
  </div>
  
  <!-- YEMEK TARÄ°FÄ° MODALI -->
  <div class="modal" id="modalRecipe">
    <div class="sheet">
      <div class="head"><div class="label-12-calibri" id="modalRecipeTitle">Yemek Tarifi</div></div>
      <div class="body" id="modalRecipeBody">
        <!-- Ä°Ã§erik JavaScript ile doldurulacak -->
      </div>
      <div class="foot">
        <button class="ghost" data-close="#modalRecipe">Kapat</button>
      </div>
    </div>
  </div>

  <script>
    // --- YardÄ±mcÄ± seÃ§iciler ---
    const el = s => document.querySelector(s);
    const els = s => Array.from(document.querySelectorAll(s));
    
    // --- Uygulama durumu ---
    let topics = JSON.parse(localStorage.getItem('topics') || '[]');
    let activeTopicForComment = null;
    let userList = JSON.parse(localStorage.getItem('userList') || '[]');

    // --- GÃ¼nÃ¼n Ä°ngilizce Kelimesi Verisi ---
    const englishWords = [
      {
        word: "Serendipity",
        pronunciation: "/ËŒser.É™nËˆdÉªp.É™.ti/",
        meaning: "Mutlu tesadÃ¼f; beklenmedik ve hoÅŸ sÃ¼rprizlerle karÅŸÄ±laÅŸma",
        example: "\"Finding this beautiful cafe was a real serendipity.\" (Bu gÃ¼zel kafeyi bulmak gerÃ§ek bir mutlu tesadÃ¼ftÃ¼.)"
      },
      {
        word: "Ephemeral",
        pronunciation: "/ÉªËˆfem.É™r.É™l/",
        meaning: "KÄ±sa Ã¶mÃ¼rlÃ¼, geÃ§ici",
        example: "\"The beauty of cherry blossoms is ephemeral.\" (Kiraz Ã§iÃ§eklerinin gÃ¼zelliÄŸi geÃ§icidir.)"
      },
      {
        word: "Resilience",
        pronunciation: "/rÉªËˆzÉªl.i.É™ns/",
        meaning: "DayanÄ±klÄ±lÄ±k, zorluklardan sonra toparlanabilme yeteneÄŸi",
        example: "\"Her resilience helped her overcome many challenges.\" (DayanÄ±klÄ±lÄ±ÄŸÄ±, birÃ§ok zorluÄŸun Ã¼stesinden gelmesine yardÄ±mcÄ± oldu.)"
      },
      {
        word: "Ubiquitous",
        pronunciation: "/juËËˆbÉªk.wÉª.tÉ™s/",
        meaning: "Her yerde bulunan, yaygÄ±n",
        example: "\"Smartphones have become ubiquitous in modern society.\" (AkÄ±llÄ± telefonlar modern toplumda her yerde bulunur hale geldi.)"
      },
      {
        word: "Melancholy",
        pronunciation: "/Ëˆmel.É™n.kÉ’l.i/",
        meaning: "HÃ¼zÃ¼n, melankoli",
        example: "\"There's a sense of melancholy in his music.\" (Onun mÃ¼ziÄŸinde bir hÃ¼zÃ¼n duygusu var.)"
      }
    ];

    // --- YEMEK TARÄ°FLERÄ° ---
    const recipes = [
      {
        id: 1,
        title: "FÄ±rÄ±nda BaharatlÄ± Tavuk",
        ingredientCount: 7,
        ingredients: "Tavuk baget, zeytinyaÄŸÄ±, sarÄ±msak, kekik, kÄ±rmÄ±zÄ± biber, tuz, karabiber",
        description: "Tavuk bagetler zeytinyaÄŸÄ± ve baharatla harmanlanÄ±p fÄ±rÄ±nda kÄ±zartÄ±lÄ±r.",
        fullRecipe: "Malzemeleri bir kapta karÄ±ÅŸtÄ±rÄ±n. TavuklarÄ± marine edip 30 dakika bekletin. 200Â°C Ã¶nceden Ä±sÄ±tÄ±lmÄ±ÅŸ fÄ±rÄ±nda 35-40 dakika piÅŸirin."
      },
      {
        id: 2,
        title: "Mercimek Ã‡orbasÄ±",
        ingredientCount: 8,
        ingredients: "KÄ±rmÄ±zÄ± mercimek, soÄŸan, havuÃ§, patates, tereyaÄŸÄ±, un, limon, tuz",
        description: "Klasik TÃ¼rk mutfaÄŸÄ±ndan doyurucu bir Ã§orba.",
        fullRecipe: "SoÄŸanÄ± ve havucu kÃ¼p kÃ¼p doÄŸrayÄ±n. TereyaÄŸÄ±nda kavurun. Mercimekleri ekleyip su ilave edin. Patatesleri ekleyip piÅŸirin. BlendÄ±rdan geÃ§irip servis yapÄ±n."
      }
    ];

    // --- VALIDASYON FONKSÄ°YONLARI ---
    const allowedDomains = ['gmail.com', 'hotmail.com', 'outlook.com', 'yahoo.com'];
    const textRegex = /^[A-Za-zÃ‡ÄÄ°Ã–ÅÃœÃ§ÄŸÄ±Ã¶ÅŸÃ¼0-9 ]+$/;

    // --- YARDIMCI FONKSÄ°YONLAR ---
    // Admin butonunu gÃ¼ncelleme
    function updateAuthButtons() {
      const session = JSON.parse(localStorage.getItem('session') || '{}');
      const guestButtons = document.getElementById('guestButtons');
      const userButton = document.getElementById('userButton');
      const adminButton = document.getElementById('adminButton');
      
      if (session.userId) {
        guestButtons.style.display = 'none';
        userButton.style.display = 'flex';
        
        // Admin kontrolÃ¼ - basit bir yÃ¶ntem
        if (session.user === 'admin' || session.userId === '00001') {
          adminButton.style.display = 'flex';
        } else {
          adminButton.style.display = 'none';
        }
      } else {
        guestButtons.style.display = 'flex';
        userButton.style.display = 'none';
        adminButton.style.display = 'none';
      }
    }

    function logout() {
      localStorage.removeItem('session');
      updateAuthButtons();
      location.hash = '#home';
      route();
      alert('Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±.');
    }

    function setEnglishWordOfTheDay() {
      const today = new Date();
      const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
      const wordIndex = dayOfYear % englishWords.length;
      const wordData = englishWords[wordIndex];
      
      el('#englishWord').textContent = wordData.word;
      el('#wordPronunciation').textContent = wordData.pronunciation;
      el('#wordMeaning').textContent = wordData.meaning;
      el('#wordExample').textContent = wordData.example;
    }

    function openModal(id) { el(id).classList.add('show'); }
    function closeModal(id) { el(id).classList.remove('show'); }
    
    function escapeHTML(s) { 
      return s.replace(/[&<>"']/g, m => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"}[m])); 
    }

    function validateEmail(email) {
      const parts = email.split('@');
      if (parts.length !== 2) return { valid: false, message: "GeÃ§ersiz e-posta formatÄ±." };
      
      const domain = parts[1].toLowerCase();
      if (!allowedDomains.includes(domain)) {
        return { 
          valid: false, 
          message: `@ iÅŸaretinden sonra sadece ${allowedDomains.join(', ')} kabul edilir.` 
        };
      }
      
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        return { valid: false, message: "GeÃ§ersiz e-posta formatÄ±." };
      }

      if (userList.some(user => user.mail.toLowerCase() === email.toLowerCase())) {
        return { valid: false, message: "Bu e-posta adresi zaten kayÄ±tlÄ±." };
      }
      
      return { valid: true, message: "" };
    }

    function validatePassword(password) {
      if (password.length < 5) return { valid: false, message: "Åifre en az 5 karakter olmalÄ±." };
      if (!/[A-Z]/.test(password)) return { valid: false, message: "Åifre en az 1 bÃ¼yÃ¼k harf iÃ§ermeli." };
      if (!/\d/.test(password)) return { valid: false, message: "Åifre en az 1 sayÄ± iÃ§ermeli." };
      return { valid: true, message: "" };
    }

    function formatUserId(id) {
      return String(id).padStart(5, '0');
    }

    // --- YEMEK TARÄ°FLERÄ° FONKSÄ°YONLARI ---
    function renderRecipes() {
      const container = el('#recipesList');
      container.innerHTML = '';
      recipes.forEach(recipe => {
        const recipeEl = document.createElement('div');
        recipeEl.className = 'recipe-item';
        recipeEl.innerHTML = `
          <div class="recipe-title">${recipe.title}</div>
          <div class="recipe-meta">
            <span>${recipe.ingredientCount} malzeme</span>
          </div>
          <div class="recipe-ingredients">${recipe.ingredients}</div>
          <button class="recipe-button" data-recipe-id="${recipe.id}">Tarif GÃ¶ster</button>
        `;
        container.appendChild(recipeEl);
      });
    }

    function showRecipeModal(recipe) {
      el('#modalRecipeTitle').textContent = recipe.title;
      el('#modalRecipeBody').innerHTML = `
        <p><strong>Malzemeler:</strong> ${recipe.ingredients}</p>
        <p><strong>HazÄ±rlanÄ±ÅŸÄ±:</strong> ${recipe.fullRecipe}</p>
      `;
      openModal('#modalRecipe');
    }

    // --- KONU FONKSÄ°YONLARI ---
    function saveTopics() { 
      localStorage.setItem('topics', JSON.stringify(topics)); 
    }

    function addTopic({title, body, userId, username}) {
      const id = (topics[0]?.id || 0) + 1;
      const t = {id, title, body, comments: [], createdAt: Date.now(), userId, username};
      topics.unshift(t);
      saveTopics();
      renderTopics();
      return t;
    }

    function renderTopics() {
      const list = el('#topicsList');
      list.innerHTML = '';
      topics.forEach((t, idx) => {
        const wrap = document.createElement('div');
        wrap.className = 'topic-item';
        wrap.setAttribute('data-topic-id', t.id);
        wrap.innerHTML = `
          <div>
            <span class="topic-id">#${t.id}</span>
            <span class="topic-head">${escapeHTML(t.title)}</span>
          </div>
          <div class="topic-desc">${(t.body || '').slice(0,20)}</div>
          <div class="topic-user">${t.username} (#${t.userId})</div>
        `;
        list.appendChild(wrap);
      });
    }

    function renderTopicDetail(t) {
      const box = el('#topicDetail');
      box.innerHTML = '';
      const h = document.createElement('div');
      h.className = 'topic-view-title';
      h.textContent = t.title;
      
      const userInfo = document.createElement('div');
      userInfo.className = 'topic-user';
      userInfo.textContent = `${t.username} (#${t.userId})`;
      userInfo.style.marginBottom = '8px';
      
      const thick = document.createElement('div'); 
      thick.className = 'thick-line'; 
      thick.style.margin = '8px 0';
      const p = document.createElement('p'); 
      p.textContent = t.body;
      const actions = document.createElement('div'); 
      actions.className = 'row'; 
      actions.style.margin = '12px 0';
      const btn = document.createElement('button'); 
      btn.textContent = 'bir ÅŸeyler yazmak istiyorum';
      btn.onclick = () => { 
        openModal('#modalComment'); 
        activeTopicForComment = t; 
      };
      actions.appendChild(btn);
      const commentsWrap = document.createElement('div');
      commentsWrap.id = 'commentsWrap';
      
      if (t.comments && t.comments.length > 0) {
        t.comments.forEach(c => {
          const it = document.createElement('div');
          it.className = 'comment-item';
          it.innerHTML = `<div><strong>${c.username} (#${c.userId})</strong>: ${c.text}</div>`;
          commentsWrap.appendChild(it);
        });
      } else {
        const noComment = document.createElement('div');
        noComment.textContent = 'HenÃ¼z yorum yapÄ±lmamÄ±ÅŸ.';
        noComment.style.color = 'var(--muted)';
        noComment.style.fontStyle = 'italic';
        commentsWrap.appendChild(noComment);
      }
      
      box.append(h, userInfo, p, thick, actions, commentsWrap);
    }

    // --- GÃœNLÃœK KOMBÄ°N FONKSÄ°YONLARI ---
    function loadDailyOutfit() {
      // LocalStorage'dan kombin verilerini yÃ¼kle
      const outfitData = JSON.parse(localStorage.getItem('outfitData') || '{}');
      
      // Kombin bilgilerini gÃ¶ster
      updateOutfitInfo(outfitData);
      
      // Kombin gÃ¶rselini gÃ¶ster
      if (outfitData.image) {
        showOutfitImage(outfitData.image);
      } else {
        showOutfitPlaceholder();
      }
    }
    
    function updateOutfitInfo(outfit) {
      if (outfit.hairstyle) {
        document.getElementById('outfitTop').textContent = outfit.top || '-';
        document.getElementById('outfitBottom').textContent = outfit.pants || '-';
        document.getElementById('outfitShoes').textContent = outfit.shoes || '-';
        document.getElementById('outfitAccessory').textContent = outfit.necklace || '-';
        
        // DetaylÄ± kombin bilgilerini gÃ¶ster
        const detailsElement = document.getElementById('outfitDetails');
        if (detailsElement) {
          detailsElement.innerHTML = `
            <h4>BugÃ¼nkÃ¼ Kombin DetaylarÄ±</h4>
            <ul>
              <li><strong>SaÃ§:</strong> ${outfit.hairstyle || '-'}</li>
              <li><strong>Toka:</strong> ${outfit.hairclip || '-'}</li>
              <li><strong>KÃ¼pe:</strong> ${outfit.earrings || '-'}</li>
              <li><strong>Kolye:</strong> ${outfit.necklace || '-'}</li>
              <li><strong>Ãœst:</strong> ${outfit.top || '-'}</li>
              <li><strong>Alt:</strong> ${outfit.pants || '-'}</li>
              <li><strong>AyakkabÄ±:</strong> ${outfit.shoes || '-'}</li>
              <li><strong>Oje:</strong> ${outfit.nailPolish || '-'}</li>
              <li><strong>YÃ¼zÃ¼k:</strong> ${outfit.ring || '-'}</li>
            </ul>
          `;
        }
      } else {
        // VarsayÄ±lan kombin bilgileri
        document.getElementById('outfitTop').textContent = "Yaka detaylÄ± crop ekru gÃ¶mlek";
        document.getElementById('outfitBottom').textContent = "Indigo mavisi jean gÃ¶mlek";
        document.getElementById('outfitShoes').textContent = "Lumberjack ROMINA 5FX siyah koÅŸu ayakkabÄ±sÄ±";
        document.getElementById('outfitAccessory').textContent = "Mini taÅŸlÄ± kolye";
      }
    }
    
    function showOutfitImage(imageSrc) {
      const placeholder = document.getElementById('outfitPlaceholder');
      const image = document.getElementById('outfitImage');
      
      if (placeholder) placeholder.style.display = 'none';
      if (image) {
        image.style.display = 'block';
        image.src = imageSrc;
      }
    }
    
    function showOutfitPlaceholder() {
      const placeholder = document.getElementById('outfitPlaceholder');
      const image = document.getElementById('outfitImage');
      
      if (placeholder) placeholder.style.display = 'block';
      if (image) image.style.display = 'none';
    }
    
    function goToAdminPanel() {
      window.location.href = 'admin.html';
    }

    // --- ROUTER ---
    function route() {
      const hash = location.hash || '#home';
      const mainContainer = document.querySelector('main.container');
      const topicView = el('#view-topic');
      
      // VarsayÄ±lan olarak ana sayfayÄ± gÃ¶ster
      if(mainContainer) mainContainer.style.display = 'grid';
      if(topicView) topicView.style.display = 'none';

      if(hash.startsWith('#topic/')) {
        const id = Number(hash.split('/')[1]);
        const t = topics.find(x => x.id === id);
        if(!t) { 
          alert('Konu bulunamadÄ±'); 
          location.hash = '#home'; 
          return; 
        }
        if(mainContainer) mainContainer.style.display = 'none';
        if(topicView) topicView.style.display = 'grid';
        renderTopicDetail(t);
      }
    }

    // --- EVENT HANDLERS ---
    document.addEventListener('DOMContentLoaded', () => {
      // GÃ¼nÃ¼n Ä°ngilizce Kelimesini Ayarla
      setEnglishWordOfTheDay();

      // GÃ¼nlÃ¼k kombin bÃ¶lÃ¼mÃ¼nÃ¼ yÃ¼kle
      loadDailyOutfit();

      // Modal kapatma butonlarÄ±
      els('[data-close]').forEach(b => b.addEventListener('click', e => closeModal(b.getAttribute('data-close'))));
      
      // Modal dÄ±ÅŸÄ±na tÄ±klama ile kapatma
      els('.modal').forEach(m => m.addEventListener('click', (e) => { 
        if(e.target === m) m.classList.remove('show'); 
      }));

      // Ana navigasyon
      el('#brandTitle').onclick = () => {
        location.hash = '#home';
        route();
      };

      el('#backToHome').onclick = (e) => {
        e.preventDefault();
        location.hash = '#home';
        route();
      };

      // Konu listesi tÄ±klama
      el('#topicsList').addEventListener('click', (e) => {
        const topicItem = e.target.closest('.topic-item');
        if (topicItem) {
          const topicId = topicItem.getAttribute('data-topic-id');
          location.hash = `#topic/${topicId}`;
          route();
        }
      });

      // Tarif butonlarÄ±
      el('#recipesList').addEventListener('click', (e) => {
        if (e.target.classList.contains('recipe-button')) {
          const recipeId = parseInt(e.target.getAttribute('data-recipe-id'));
          const recipe = recipes.find(r => r.id === recipeId);
          if (recipe) {
            showRecipeModal(recipe);
          }
        }
      });

      // Auth modallarÄ±
      el('#btnLogin').onclick = () => openModal('#modalLogin');
      el('#btnSignup').onclick = () => openModal('#modalSignup');

      // Profil butonu - profile.html'ye yÃ¶nlendir
      el('#btnProfileHeader').onclick = () => {
        window.location.href = 'profile.html';
      };

      // Admin paneli butonu
      el('#btnAdminPanel').onclick = () => {
        window.location.href = 'admin.html';
      };

      // Kombin yÃ¶netme butonu
      el('#btnManageOutfits').onclick = goToAdminPanel;

      // Ã‡Ä±kÄ±ÅŸ yap butonu
      el('#btnLogout').onclick = logout;

      // Konu AÃ§ ModalÄ±
      el('#btnNewTopic').onclick = () => {
        const session = JSON.parse(localStorage.getItem('session') || '{}');
        if (!session.userId) {
          alert('Konu aÃ§mak iÃ§in giriÅŸ yapmalÄ±sÄ±nÄ±z!');
          openModal('#modalLogin');
          return;
        }
        openModal('#modalTopic');
      };

      el('#btnSaveTopic').onclick = () => {
        const session = JSON.parse(localStorage.getItem('session') || '{}');
        if (!session.userId) {
          alert('Konu aÃ§mak iÃ§in giriÅŸ yapmalÄ±sÄ±nÄ±z!');
          openModal('#modalLogin');
          return;
        }

        const title = el('#inpTopicTitle').value.trim();
        const body = el('#inpTopicBody').value.trim();
        if(title.length === 0 || body.length === 0) { 
          alert('BaÅŸlÄ±k ve konu metni gerekli.'); 
          return;
        }
        if(title.length > 15) { 
          alert('BaÅŸlÄ±k 15 karakteri aÅŸamaz.'); 
          return; 
        }
        if(body.length > 250) { 
          alert('Konu 250 karakteri aÅŸamaz.'); 
          return; 
        }
        if(!textRegex.test(title) || !textRegex.test(body)) {
          alert('Ã–zel karakterlere izin verilmez. Sadece harf, rakam ve boÅŸluk kullanÄ±n.');
          return;
        }
        addTopic({
          title, 
          body, 
          userId: session.userId, 
          username: session.user
        });
        closeModal('#modalTopic');
        el('#inpTopicTitle').value = '';
        el('#inpTopicBody').value = '';
      };

      // Yorum gÃ¶nderme
      el('#btnSendComment').onclick = () => {
        const session = JSON.parse(localStorage.getItem('session') || '{}');
        if (!session.userId) {
          alert('Yorum yapmak iÃ§in giriÅŸ yapmalÄ±sÄ±nÄ±z!');
          openModal('#modalLogin');
          return;
        }
        const txt = el('#inpComment').value.trim();
        if(txt.length === 0) { 
          alert('Yorum boÅŸ olamaz'); 
          return; 
        }
        if(txt.length > 250) { 
          alert('Yorum 250 karakteri geÃ§emez'); 
          return; 
        }
        if (!activeTopicForComment) {
          alert('Bir konu seÃ§ilmedi');
          return;
        }
        
        const idx = topics.findIndex(x => x.id === activeTopicForComment.id);
        if(idx > -1) { 
          if (!topics[idx].comments) topics[idx].comments = [];
          topics[idx].comments.push({
            text: txt, 
            at: Date.now(),
            userId: session.userId,
            username: session.user
          }); 
          saveTopics(); 
        }
        el('#inpComment').value = '';
        closeModal('#modalComment');
        renderTopicDetail(topics[idx]);
      };

      // Login
      el('#btnDoLogin').onclick = () => {
        const u = el('#loginUser').value.trim();
        const p = el('#loginPass').value.trim();
        if(!u || !p) { 
          alert('KullanÄ±cÄ± adÄ± ve ÅŸifre gerekli.'); 
          return; 
        }
        const acc = JSON.parse(localStorage.getItem('account') || 'null');
        if(acc && acc.user === u && acc.pass === p) {
          localStorage.setItem('session', JSON.stringify({user: u, userId: acc.userId}));
          closeModal('#modalLogin');
          alert('GiriÅŸ baÅŸarÄ±lÄ±.');
          updateAuthButtons();
          location.hash = '#home';
          route();
        } else {
          alert('KullanÄ±cÄ± adÄ± veya ÅŸifre hatalÄ±.');
        }
      };

      // Signup
      el('#btnDoSignup').onclick = () => {
        const mail = el('#suMail').value.trim();
        const user = el('#suUser').value.trim();
        const pass = el('#suPass').value.trim();
        const pass2 = el('#suPass2').value.trim();
        if(!mail || !user || !pass || !pass2) { 
          alert('TÃ¼m alanlar gerekli.'); 
          return; 
        }
        const mailValidation = validateEmail(mail);
        if (!mailValidation.valid) {
          alert(mailValidation.message);
          return;
        }
        const passValidation = validatePassword(pass);
        if (!passValidation.valid) {
          alert(passValidation.message);
          return;
        }
        if(pass !== pass2) { 
          alert('Åifreler eÅŸleÅŸmiyor.'); 
          return; 
        }
        const nextUserId = parseInt(localStorage.getItem('nextUserId') || '1', 10);
        const userId = formatUserId(nextUserId);
        localStorage.setItem('account', JSON.stringify({mail, user, pass, userId}));
        localStorage.setItem('nextUserId', (nextUserId + 1).toString());
        localStorage.setItem('session', JSON.stringify({user, userId}));
        closeModal('#modalSignup');
        
        // Profil verilerini oluÅŸtur
        if(!localStorage.getItem('profile')) {
          localStorage.setItem('profile', JSON.stringify({
            user, 
            userId,
            pfp: null, 
            savedLoc: null,
            parkingNo: null,
            shoppingList: [],
            habits: [],
            specialDays: []
          }));
        } else {
          const prof = JSON.parse(localStorage.getItem('profile'));
          prof.user = user;
          prof.userId = userId;
          localStorage.setItem('profile', JSON.stringify(prof));
        }
        updateAuthButtons();
        location.hash = '#home';
        route();
      };

      // Ä°lk render
      renderTopics();
      renderRecipes();
      route();
      updateAuthButtons();
    });

    // Hash deÄŸiÅŸikliklerini dinle
    window.addEventListener('hashchange', route);
  </script>
</body>
</html>
