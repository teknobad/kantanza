<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KANTANZA - Admin Paneli</title>
  <style>
    :root{
      --bg:#0f1115;
      --card:#151922;
      --ink:#e8ebf1;
      --muted:#a9b0bf;
      --accent:#69bffc;
      --line:#2b3240;
      --danger:#ff6b6b;
      --ok:#7fdc82;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:Calibri, Arial, Helvetica, sans-serif;}

    /* Genel iskelet */
    .container{max-width:1200px;margin:0 auto;padding:16px;display:grid;grid-template-columns:1fr;gap:16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .pad{padding:16px}
    .row{display:flex;align-items:center;gap:10px}
    .between{display:flex;align-items:center;justify-content:space-between}
    .line{height:1px;background:var(--line);}
    .thick-line{height:4px;background:var(--line);border-radius:2px}
    a{color:var(--ink);text-decoration:none}
    button{background:var(--accent);color:#0b0d12;border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;color:var(--ink);border:1px solid var(--line)}
    button.danger{background:var(--danger);color:white}
    button:disabled{opacity:.6;cursor:not-allowed}
    input, textarea, select{width:100%;background:#0f131a;border:1px solid var(--line);border-radius:10px;color:var(--ink);padding:10px}
    label{display:block;margin:10px 0 6px}

    /* Başlık alanı */
    header.card{grid-column:1 / -1;}
    .brand{font-family:'Arial Black', Arial, Helvetica, sans-serif;font-size:18pt;font-weight:900;letter-spacing:.5px;cursor:pointer}
    .brand-underline{height:3px;background:var(--ink);width:max(140px, 14ch);border-radius:3px;margin-top:6px}
    .auth-actions{gap:10px}

    /* Başlık alanı - ORTALAMA İÇİN */
    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }

    .brand-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Admin Grid */
    .admin-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    /* Tablo Stilleri */
    .admin-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    
    .admin-table th, .admin-table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid var(--line);
    }
    
    .admin-table th {
      background: rgba(255,255,255,0.05);
      font-weight: bold;
    }
    
    .admin-table tr:hover {
      background: rgba(255,255,255,0.03);
    }

    /* Form Stilleri */
    .admin-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .form-group {
      margin-bottom: 12px;
    }
    
    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 16px;
    }

    /* Bölümler */
    .section {
      margin-bottom: 24px;
    }
    
    .section-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--line);
    }

    /* İstatistikler */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .stat-card {
      background: var(--card);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      border: 1px solid var(--line);
    }
    
    .stat-number {
      font-size: 28px;
      font-weight: bold;
      color: var(--accent);
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: 14px;
      color: var(--muted);
    }

    /* Küçük butonlar */
    .small-button {
      padding: 6px 10px;
      font-size: 12px;
    }

    /* Görsel Yükleme Alanı */
    .image-upload-area {
      width: 100%;
      height: 200px;
      border: 2px dashed var(--line);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 16px;
      position: relative;
      overflow: hidden;
    }
    
    .image-upload-area:hover {
      border-color: var(--accent);
      background: rgba(105, 191, 252, 0.05);
    }
    
    .image-upload-area i {
      font-size: 48px;
      color: var(--muted);
      margin-bottom: 12px;
    }
    
    .image-upload-area .upload-text {
      color: var(--muted);
      text-align: center;
      padding: 0 16px;
    }
    
    .image-preview {
      width: 100%;
      height: 100%;
      display: none;
      position: relative;
    }
    
    .image-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }
    
    .image-actions {
      position: absolute;
      bottom: 12px;
      right: 12px;
      display: flex;
      gap: 8px;
    }
    
    .image-action-btn {
      background: rgba(15, 17, 21, 0.8);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      backdrop-filter: blur(4px);
    }

    /* Mobil için responsive */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 12px;
      }
      
      .auth-actions {
        width: 100%;
        justify-content: center;
      }
      
      .admin-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- ÜST BÖLÜM: Marka ve Auth -->
  <header class="card pad">
    <div class="header-content">
      <div class="brand-container">
        <div class="brand" id="brandTitle">KANTANZA - Admin Paneli</div>
        <div class="brand-underline"></div>
      </div>
      <div class="auth-actions">
        <button id="btnGoBack" class="ghost">Foruma Dön</button>
        <button id="btnLogout" class="danger">Çıkış</button>
      </div>
    </div>
    <div class="line" style="margin-top:12px"></div>
  </header>

  <main class="container">
    <!-- İstatistikler -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="statTopics">0</div>
        <div class="stat-label">Toplam Konu</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="statComments">0</div>
        <div class="stat-label">Toplam Yorum</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="statRecipes">0</div>
        <div class="stat-label">Yemek Tarifi</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="statUsers">0</div>
        <div class="stat-label">Kayıtlı Kullanıcı</div>
      </div>
    </div>

    <div class="admin-grid">
      <!-- Sol Kolon -->
      <div>
        <!-- Konu Yönetimi -->
        <div class="card pad section">
          <div class="section-title">Konu Yönetimi</div>
          <div class="admin-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Başlık</th>
                  <th>Yazar</th>
                  <th>İşlem</th>
                </tr>
              </thead>
              <tbody id="topicsTable">
                <!-- Konular buraya eklenecek -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Yorum Yönetimi -->
        <div class="card pad section">
          <div class="section-title">Yorum Yönetimi</div>
          <div class="admin-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Konu</th>
                  <th>Yorum</th>
                  <th>Yazar</th>
                  <th>İşlem</th>
                </tr>
              </thead>
              <tbody id="commentsTable">
                <!-- Yorumlar buraya eklenecek -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Sağ Kolon -->
      <div>
        <!-- Film Tavsiyesi Düzenleme -->
        <div class="card pad section">
          <div class="section-title">Film Tavsiyesi Düzenleme</div>
          <div class="admin-form">
            <div class="form-group">
              <label for="movieTitle">Film Adı</label>
              <input type="text" id="movieTitle" placeholder="Film adı">
            </div>
            <div class="form-group">
              <label for="movieActors">Oyuncular</label>
              <input type="text" id="movieActors" placeholder="Oyuncu isimleri">
            </div>
            <div class="form-group">
              <label for="movieDescription">Açıklama</label>
              <textarea id="movieDescription" rows="3" placeholder="Film açıklaması"></textarea>
            </div>
            <div class="form-group">
              <label for="movieImdb">IMDb Puanı</label>
              <input type="text" id="movieImdb" placeholder="8.6">
            </div>
            <div class="form-group">
              <label for="movieRottenTomatoes">Rotten Tomatoes</label>
              <input type="text" id="movieRottenTomatoes" placeholder="94%">
            </div>
            <div class="form-group">
              <label for="movieAgeLimit">Yaş Sınırı</label>
              <input type="text" id="movieAgeLimit" placeholder="+18 değil">
            </div>
            <div class="form-group">
              <label for="movieGenres">Türler</label>
              <input type="text" id="movieGenres" placeholder="Macera • Korku • Gizem">
            </div>
            <div class="form-group">
              <label for="movieImage">Görsel URL</label>
              <input type="url" id="movieImage" placeholder="Film görseli URL">
            </div>
            <div class="form-actions">
              <button type="button" class="ghost" id="btnResetMovie">Sıfırla</button>
              <button type="button" id="btnSaveMovie">Film Bilgisini Kaydet</button>
            </div>
          </div>
        </div>

        <!-- Dizi Tavsiyesi Düzenleme -->
        <div class="card pad section">
          <div class="section-title">Dizi Tavsiyesi Düzenleme</div>
          <div class="admin-form">
            <div class="form-group">
              <label for="seriesTitle">Dizi Adı</label>
              <input type="text" id="seriesTitle" placeholder="Dizi adı">
            </div>
            <div class="form-group">
              <label for="seriesImdb">IMDb Puanı</label>
              <input type="text" id="seriesImdb" placeholder="8.8/10">
            </div>
            <div class="form-group">
              <label for="seriesSubject">Konu</label>
              <textarea id="seriesSubject" rows="3" placeholder="Dizi konusu"></textarea>
            </div>
            <div class="form-group">
              <label for="seriesSeasons">Sezon Sayısı</label>
              <input type="text" id="seriesSeasons" placeholder="3 sezon">
            </div>
            <div class="form-group">
              <label for="seriesBestEpisode">En Sevilen Bölüm</label>
              <input type="text" id="seriesBestEpisode" placeholder="Sonsuzluk Yolculuğu (3. Sezon 8. Bölüm)">
            </div>
            <div class="form-group">
              <label for="seriesImage">Görsel URL</label>
              <input type="url" id="seriesImage" placeholder="Dizi görseli URL">
            </div>
            <div class="form-actions">
              <button type="button" class="ghost" id="btnResetSeries">Sıfırla</button>
              <button type="button" id="btnSaveSeries">Dizi Bilgisini Kaydet</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Kombin Düzenleme -->
    <div class="card pad section">
      <div class="section-title">Kombin Düzenleme</div>
      <div class="admin-form">
        <!-- Kombin Görsel Yükleme -->
        <div class="form-group">
          <label>Kombin Görseli</label>
          <div class="image-upload-area" id="outfitImageUploadArea">
            <div class="upload-placeholder" id="outfitUploadPlaceholder">
              <i>📷</i>
              <div class="upload-text">Kombin görseli yüklemek için tıklayın</div>
              <small style="margin-top: 8px; color: var(--muted);">PNG, JPG, GIF - Maks. 5MB</small>
            </div>
            <div class="image-preview" id="outfitImagePreview">
              <img id="outfitPreviewImage" src="" alt="Kombin görseli">
              <div class="image-actions">
                <button type="button" class="image-action-btn" id="btnChangeOutfitImage">Değiştir</button>
                <button type="button" class="image-action-btn danger" id="btnRemoveOutfitImage">Kaldır</button>
              </div>
            </div>
            <input type="file" id="outfitImageInput" accept="image/*" style="display: none;">
          </div>
        </div>

        <div class="form-group">
          <label for="outfitHairstyle">Saç Şekli</label>
          <input type="text" id="outfitHairstyle" placeholder="Saç şekli">
        </div>
        <div class="form-group">
          <label for="outfitHairclip">Toka</label>
          <input type="text" id="outfitHairclip" placeholder="Toka modeli">
        </div>
        <div class="form-group">
          <label for="outfitEarrings">Küpe</label>
          <input type="text" id="outfitEarrings" placeholder="Küpe modeli">
        </div>
        <div class="form-group">
          <label for="outfitNecklace">Kolye</label>
          <input type="text" id="outfitNecklace" placeholder="Kolye modeli">
        </div>
        <div class="form-group">
          <label for="outfitTop">Üst Giyim</label>
          <input type="text" id="outfitTop" placeholder="Üst giyim">
        </div>
        <div class="form-group">
          <label for="outfitPants">Pantolon</label>
          <input type="text" id="outfitPants" placeholder="Pantolon modeli">
        </div>
        <div class="form-group">
          <label for="outfitShoes">Ayakkabı</label>
          <input type="text" id="outfitShoes" placeholder="Ayakkabı modeli">
        </div>
        <div class="form-group">
          <label for="outfitNailPolish">Oje</label>
          <input type="text" id="outfitNailPolish" placeholder="Oje rengi/tipi">
        </div>
        <div class="form-group">
          <label for="outfitRing">Yüzük</label>
          <input type="text" id="outfitRing" placeholder="Yüzük modeli">
        </div>
        <div class="form-actions">
          <button type="button" class="ghost" id="btnResetOutfit">Sıfırla</button>
          <button type="button" id="btnSaveOutfit">Kombini Kaydet</button>
        </div>
      </div>
    </div>

    <!-- Yemek Tarifleri Yönetimi -->
    <div class="card pad section">
      <div class="section-title">Yemek Tarifleri Yönetimi</div>
      <div class="admin-form">
        <div class="form-group">
          <label for="recipeTitle">Tarif Adı</label>
          <input type="text" id="recipeTitle" placeholder="Tarif adı">
        </div>
        <div class="form-group">
          <label for="recipeIngredients">Malzemeler (virgülle ayırın)</label>
          <textarea id="recipeIngredients" rows="3" placeholder="Malzemeler"></textarea>
        </div>
        <div class="form-group">
          <label for="recipeDescription">Kısa Açıklama</label>
          <input type="text" id="recipeDescription" placeholder="Kısa açıklama">
        </div>
        <div class="form-group">
          <label for="recipeFull">Tam Tarif</label>
          <textarea id="recipeFull" rows="4" placeholder="Tam tarif"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="ghost" id="btnResetRecipe">Temizle</button>
          <button type="button" class="ghost" id="btnNewRecipe">Yeni Tarif</button>
          <button type="button" id="btnSaveRecipe">Tarifi Kaydet</button>
        </div>
      </div>
      
      <div class="section-title" style="margin-top: 24px;">Mevcut Tarifler</div>
      <div class="admin-table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Tarif Adı</th>
              <th>Malzeme Sayısı</th>
              <th>İşlem</th>
            </tr>
          </thead>
          <tbody id="recipesTable">
            <!-- Tarifler buraya eklenecek -->
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <script>
    // Yardımcı seçiciler
    const el = s => document.querySelector(s);
    const els = s => Array.from(document.querySelectorAll(s));

    // Uygulama durumu
    let topics = JSON.parse(localStorage.getItem('topics') || '[]');
    let recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
    let currentEditingRecipeId = null;
    let currentOutfitImage = null;

    // Varsayılan veriler
    const defaultMovieData = {
      title: "Karanlığın Ormanı",
      actors: "A. Kaya, B. Demir, C. Öz",
      description: "Issız bir dağ kasabasında kaybolan kampçılar, eski bir efsanenin peşinden sürüklenir.",
      imdb: "8.6",
      rottenTomatoes: "94%",
      ageLimit: "+18 değil",
      genres: "Macera • Korku • Gizem",
      image: ""
    };

    const defaultSeriesData = {
      title: "Zamanın Ötesinde",
      imdb: "8.8/10",
      subject: "Gelecekten gelen bir zaman yolcusunun, tarihi olayları değiştirmeye çalışan bir organizasyonla mücadelesi.",
      seasons: "3 sezon",
      bestEpisode: "Sonsuzluk Yolculuğu (3. Sezon 8. Bölüm)",
      image: ""
    };

    const defaultOutfitData = {
      hairstyle: "Topuz",
      hairclip: "Good Hair Days Magic-grip Saç Topuz Tokası",
      earrings: "Halka küpe",
      necklace: "Mini taşlı kolye",
      top: "Yaka detaylı crop ekru gömlek",
      pants: "Indigo mavisi jean gömlek",
      shoes: "Lumberjack ROMINA 5FX siyah koşu ayakkabısı",
      nailPolish: "Pastel oje",
      ring: "Eklem yüzüğü",
      image: null
    };

    // İstatistikleri güncelle
    function updateStats() {
      // Toplam konu sayısı
      el('#statTopics').textContent = topics.length;
      
      // Toplam yorum sayısı
      let totalComments = 0;
      topics.forEach(topic => {
        if (topic.comments) {
          totalComments += topic.comments.length;
        }
      });
      el('#statComments').textContent = totalComments;
      
      // Toplam tarif sayısı
      el('#statRecipes').textContent = recipes.length;
      
      // Kayıtlı kullanıcı sayısı
      const userList = JSON.parse(localStorage.getItem('userList') || '[]');
      const account = JSON.parse(localStorage.getItem('account') || 'null');
      const nextUserId = parseInt(localStorage.getItem('nextUserId') || '1', 10);
      
      let userCount = userList.length;
      if (account) userCount += 1;
      if (nextUserId > 1) {
        userCount = Math.max(userCount, nextUserId - 1);
      }
      
      el('#statUsers').textContent = userCount;
    }

    // Konuları tabloya yükle
    function loadTopicsTable() {
      const tableBody = el('#topicsTable');
      tableBody.innerHTML = '';
      
      if (topics.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = `<td colspan="4" style="text-align: center; color: var(--muted);">Henüz konu bulunmuyor</td>`;
        tableBody.appendChild(row);
        return;
      }
      
      topics.forEach(topic => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>#${topic.id}</td>
          <td>${topic.title}</td>
          <td>${topic.username || 'Anonim'} (#${topic.userId || '?'})</td>
          <td>
            <button class="danger small-button delete-topic" data-id="${topic.id}">Sil</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
      
      // Silme butonlarına event listener ekle
      els('.delete-topic').forEach(btn => {
        btn.addEventListener('click', function() {
          const topicId = parseInt(this.getAttribute('data-id'));
          deleteTopic(topicId);
        });
      });
    }

    // Yorumları tabloya yükle
    function loadCommentsTable() {
      const tableBody = el('#commentsTable');
      tableBody.innerHTML = '';
      
      let hasComments = false;
      
      topics.forEach(topic => {
        if (topic.comments && topic.comments.length > 0) {
          hasComments = true;
          topic.comments.forEach(comment => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${topic.title}</td>
              <td>${comment.text.length > 50 ? comment.text.substring(0, 50) + '...' : comment.text}</td>
              <td>${comment.username || 'Anonim'} (#${comment.userId || '?'})</td>
              <td>
                <button class="danger small-button delete-comment" data-topic-id="${topic.id}" data-comment-index="${topic.comments.indexOf(comment)}">Sil</button>
              </td>
            `;
            tableBody.appendChild(row);
          });
        }
      });
      
      if (!hasComments) {
        const row = document.createElement('tr');
        row.innerHTML = `<td colspan="4" style="text-align: center; color: var(--muted);">Henüz yorum bulunmuyor</td>`;
        tableBody.appendChild(row);
      }
      
      // Silme butonlarına event listener ekle
      els('.delete-comment').forEach(btn => {
        btn.addEventListener('click', function() {
          const topicId = parseInt(this.getAttribute('data-topic-id'));
          const commentIndex = parseInt(this.getAttribute('data-comment-index'));
          deleteComment(topicId, commentIndex);
        });
      });
    }

    // Tarifleri tabloya yükle
    function loadRecipesTable() {
      const tableBody = el('#recipesTable');
      tableBody.innerHTML = '';
      
      if (recipes.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = `<td colspan="4" style="text-align: center; color: var(--muted);">Henüz tarif bulunmuyor</td>`;
        tableBody.appendChild(row);
        return;
      }
      
      recipes.forEach(recipe => {
        const ingredientCount = recipe.ingredientCount || (recipe.ingredients ? recipe.ingredients.split(',').length : 0);
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${recipe.id}</td>
          <td>${recipe.title}</td>
          <td>${ingredientCount}</td>
          <td>
            <button class="ghost small-button edit-recipe" data-id="${recipe.id}">Düzenle</button>
            <button class="danger small-button delete-recipe" data-id="${recipe.id}">Sil</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
      
      // Düzenle butonlarına event listener ekle
      els('.edit-recipe').forEach(btn => {
        btn.addEventListener('click', function() {
          const recipeId = parseInt(this.getAttribute('data-id'));
          editRecipe(recipeId);
        });
      });
      
      // Silme butonlarına event listener ekle
      els('.delete-recipe').forEach(btn => {
        btn.addEventListener('click', function() {
          const recipeId = parseInt(this.getAttribute('data-id'));
          deleteRecipe(recipeId);
        });
      });
    }

    // Konuyu sil
    function deleteTopic(id) {
      if (confirm('Bu konuyu silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.')) {
        topics = topics.filter(topic => topic.id !== id);
        localStorage.setItem('topics', JSON.stringify(topics));
        loadTopicsTable();
        loadCommentsTable();
        updateStats();
        alert('Konu başarıyla silindi.');
      }
    }

    // Yorumu sil
    function deleteComment(topicId, commentIndex) {
      if (confirm('Bu yorumu silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.')) {
        const topicIndex = topics.findIndex(topic => topic.id === topicId);
        if (topicIndex !== -1 && topics[topicIndex].comments) {
          topics[topicIndex].comments.splice(commentIndex, 1);
          localStorage.setItem('topics', JSON.stringify(topics));
          loadCommentsTable();
          updateStats();
          alert('Yorum başarıyla silindi.');
        }
      }
    }

    // Tarifi düzenle
    function editRecipe(id) {
      const recipe = recipes.find(r => r.id === id);
      if (recipe) {
        currentEditingRecipeId = id;
        el('#recipeTitle').value = recipe.title || '';
        el('#recipeIngredients').value = recipe.ingredients || '';
        el('#recipeDescription').value = recipe.description || '';
        el('#recipeFull').value = recipe.fullRecipe || '';
        
        el('#btnSaveRecipe').textContent = 'Tarifi Güncelle';
      }
    }

    // Tarifi sil
    function deleteRecipe(id) {
      if (confirm('Bu tarifi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.')) {
        recipes = recipes.filter(recipe => recipe.id !== id);
        localStorage.setItem('recipes', JSON.stringify(recipes));
        loadRecipesTable();
        updateStats();
        alert('Tarif başarıyla silindi.');
      }
    }

    // Film bilgilerini kaydet
    function saveMovieData() {
      const movieData = {
        title: el('#movieTitle').value,
        actors: el('#movieActors').value,
        description: el('#movieDescription').value,
        imdb: el('#movieImdb').value,
        rottenTomatoes: el('#movieRottenTomatoes').value,
        ageLimit: el('#movieAgeLimit').value,
        genres: el('#movieGenres').value,
        image: el('#movieImage').value
      };
      
      localStorage.setItem('movieData', JSON.stringify(movieData));
      localStorage.setItem('movieRecommendation', JSON.stringify(movieData));
      alert('Film bilgileri başarıyla kaydedildi.');
    }

    // Dizi bilgilerini kaydet
    function saveSeriesData() {
      const seriesData = {
        title: el('#seriesTitle').value,
        imdb: el('#seriesImdb').value,
        subject: el('#seriesSubject').value,
        seasons: el('#seriesSeasons').value,
        bestEpisode: el('#seriesBestEpisode').value,
        image: el('#seriesImage').value
      };
      
      localStorage.setItem('seriesData', JSON.stringify(seriesData));
      localStorage.setItem('seriesRecommendation', JSON.stringify(seriesData));
      alert('Dizi bilgileri başarıyla kaydedildi.');
    }

    // Kombin görseli yükleme işlevleri
    function initOutfitImageUpload() {
      const imageUploadArea = el('#outfitImageUploadArea');
      const imageInput = el('#outfitImageInput');
      const uploadPlaceholder = el('#outfitUploadPlaceholder');
      const imagePreview = el('#outfitImagePreview');
      const previewImage = el('#outfitPreviewImage');
      const btnChangeImage = el('#btnChangeOutfitImage');
      const btnRemoveImage = el('#btnRemoveOutfitImage');
      
      // Tıklama ile dosya seç
      imageUploadArea.addEventListener('click', (e) => {
        if (e.target !== btnChangeImage && e.target !== btnRemoveImage) {
          imageInput.click();
        }
      });
      
      // Dosya seçildiğinde
      imageInput.addEventListener('change', handleOutfitImageUpload);
      
      // Görsel değiştirme butonu
      btnChangeImage.addEventListener('click', (e) => {
        e.stopPropagation();
        imageInput.click();
      });
      
      // Görsel kaldırma butonu
      btnRemoveImage.addEventListener('click', (e) => {
        e.stopPropagation();
        resetOutfitImage();
      });
    }
    
    function handleOutfitImageUpload() {
      const file = el('#outfitImageInput').files[0];
      if (!file) return;
      
      // Dosya türü kontrolü
      if (!file.type.match('image.*')) {
        alert('Sadece resim dosyaları yükleyebilirsiniz!');
        return;
      }
      
      // Dosya boyutu kontrolü (max 5MB)
      if (file.size > 5 * 1024 * 1024) {
        alert('Resim boyutu 5MB\'dan küçük olmalıdır!');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        currentOutfitImage = e.target.result;
        showOutfitImagePreview(currentOutfitImage);
      };
      reader.readAsDataURL(file);
    }
    
    function showOutfitImagePreview(src) {
      el('#outfitUploadPlaceholder').style.display = 'none';
      el('#outfitImagePreview').style.display = 'block';
      el('#outfitPreviewImage').src = src;
    }
    
    function resetOutfitImage() {
      el('#outfitUploadPlaceholder').style.display = 'flex';
      el('#outfitImagePreview').style.display = 'none';
      el('#outfitPreviewImage').src = '';
      el('#outfitImageInput').value = '';
      currentOutfitImage = null;
    }

    // Kombin bilgilerini kaydet
    function saveOutfitData() {
      const outfitData = {
        hairstyle: el('#outfitHairstyle').value,
        hairclip: el('#outfitHairclip').value,
        earrings: el('#outfitEarrings').value,
        necklace: el('#outfitNecklace').value,
        top: el('#outfitTop').value,
        pants: el('#outfitPants').value,
        shoes: el('#outfitShoes').value,
        nailPolish: el('#outfitNailPolish').value,
        ring: el('#outfitRing').value,
        image: currentOutfitImage
      };
      
      localStorage.setItem('outfitData', JSON.stringify(outfitData));
      alert('Kombin bilgileri başarıyla kaydedildi.');
    }

    // Tarif kaydet
    function saveRecipe() {
      const title = el('#recipeTitle').value.trim();
      const ingredients = el('#recipeIngredients').value.trim();
      const description = el('#recipeDescription').value.trim();
      const fullRecipe = el('#recipeFull').value.trim();
      
      if (!title || !ingredients || !description || !fullRecipe) {
        alert('Lütfen tüm alanları doldurun.');
        return;
      }
      
      if (currentEditingRecipeId) {
        // Mevcut tarifi güncelle
        const recipeIndex = recipes.findIndex(r => r.id === currentEditingRecipeId);
        if (recipeIndex !== -1) {
          recipes[recipeIndex] = {
            ...recipes[recipeIndex],
            title,
            ingredients,
            description,
            fullRecipe,
            ingredientCount: ingredients.split(',').length
          };
        }
        currentEditingRecipeId = null;
        el('#btnSaveRecipe').textContent = 'Tarifi Kaydet';
      } else {
        // Yeni tarif ekle
        const newId = recipes.length > 0 ? Math.max(...recipes.map(r => r.id)) + 1 : 1;
        recipes.push({
          id: newId,
          title,
          ingredients,
          description,
          fullRecipe,
          ingredientCount: ingredients.split(',').length
        });
      }
      
      localStorage.setItem('recipes', JSON.stringify(recipes));
      loadRecipesTable();
      updateStats();
      resetRecipeForm();
      alert('Tarif başarıyla kaydedildi.');
    }

    // Film formunu sıfırla
    function resetMovieForm() {
      el('#movieTitle').value = defaultMovieData.title;
      el('#movieActors').value = defaultMovieData.actors;
      el('#movieDescription').value = defaultMovieData.description;
      el('#movieImdb').value = defaultMovieData.imdb;
      el('#movieRottenTomatoes').value = defaultMovieData.rottenTomatoes;
      el('#movieAgeLimit').value = defaultMovieData.ageLimit;
      el('#movieGenres').value = defaultMovieData.genres;
      el('#movieImage').value = defaultMovieData.image;
    }

    // Dizi formunu sıfırla
    function resetSeriesForm() {
      el('#seriesTitle').value = defaultSeriesData.title;
      el('#seriesImdb').value = defaultSeriesData.imdb;
      el('#seriesSubject').value = defaultSeriesData.subject;
      el('#seriesSeasons').value = defaultSeriesData.seasons;
      el('#seriesBestEpisode').value = defaultSeriesData.bestEpisode;
      el('#seriesImage').value = defaultSeriesData.image;
    }

    // Kombin formunu sıfırla
    function resetOutfitForm() {
      el('#outfitHairstyle').value = defaultOutfitData.hairstyle;
      el('#outfitHairclip').value = defaultOutfitData.hairclip;
      el('#outfitEarrings').value = defaultOutfitData.earrings;
      el('#outfitNecklace').value = defaultOutfitData.necklace;
      el('#outfitTop').value = defaultOutfitData.top;
      el('#outfitPants').value = defaultOutfitData.pants;
      el('#outfitShoes').value = defaultOutfitData.shoes;
      el('#outfitNailPolish').value = defaultOutfitData.nailPolish;
      el('#outfitRing').value = defaultOutfitData.ring;
      resetOutfitImage();
    }

    // Tarif formunu sıfırla
    function resetRecipeForm() {
      el('#recipeTitle').value = '';
      el('#recipeIngredients').value = '';
      el('#recipeDescription').value = '';
      el('#recipeFull').value = '';
      currentEditingRecipeId = null;
      el('#btnSaveRecipe').textContent = 'Tarifi Kaydet';
    }

    // Formları localStorage'dan verilerle doldur
    function loadFormData() {
      // Film verilerini yükle
      const movieData = JSON.parse(localStorage.getItem('movieData') || JSON.stringify(defaultMovieData));
      el('#movieTitle').value = movieData.title;
      el('#movieActors').value = movieData.actors;
      el('#movieDescription').value = movieData.description;
      el('#movieImdb').value = movieData.imdb;
      el('#movieRottenTomatoes').value = movieData.rottenTomatoes;
      el('#movieAgeLimit').value = movieData.ageLimit;
      el('#movieGenres').value = movieData.genres;
      el('#movieImage').value = movieData.image || '';
      
      // Dizi verilerini yükle
      const seriesData = JSON.parse(localStorage.getItem('seriesData') || JSON.stringify(defaultSeriesData));
      el('#seriesTitle').value = seriesData.title;
      el('#seriesImdb').value = seriesData.imdb;
      el('#seriesSubject').value = seriesData.subject;
      el('#seriesSeasons').value = seriesData.seasons;
      el('#seriesBestEpisode').value = seriesData.bestEpisode;
      el('#seriesImage').value = seriesData.image || '';
      
      // Kombin verilerini yükle
      const outfitData = JSON.parse(localStorage.getItem('outfitData') || JSON.stringify(defaultOutfitData));
      el('#outfitHairstyle').value = outfitData.hairstyle;
      el('#outfitHairclip').value = outfitData.hairclip;
      el('#outfitEarrings').value = outfitData.earrings;
      el('#outfitNecklace').value = outfitData.necklace;
      el('#outfitTop').value = outfitData.top;
      el('#outfitPants').value = outfitData.pants;
      el('#outfitShoes').value = outfitData.shoes;
      el('#outfitNailPolish').value = outfitData.nailPolish;
      el('#outfitRing').value = outfitData.ring;
      
      // Kombin görselini yükle
      if (outfitData.image) {
        currentOutfitImage = outfitData.image;
        showOutfitImagePreview(outfitData.image);
      }
    }

    // Admin kontrolü
    function checkAdminAccess() {
      const session = JSON.parse(localStorage.getItem('session') || '{}');
      const adminSession = localStorage.getItem('adminSession');
      
      // Basit admin kontrolü - kullanıcı adı "admin" veya userId "00001" ise admin
      if (session.user === 'admin' || session.userId === '00001' || adminSession === 'true') {
        return true;
      }
      
      // Alternatif olarak şifre kontrolü
      const password = prompt('Admin şifresini girin:');
      if (password === 'admin123') {
        localStorage.setItem('adminSession', 'true');
        return true;
      }
      
      alert('Yetkiniz yok!');
      window.location.href = 'index.html';
      return false;
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Önce admin kontrolü yap
      if (!checkAdminAccess()) {
        return;
      }
      
      // İstatistikleri ve tabloları yükle
      updateStats();
      loadTopicsTable();
      loadCommentsTable();
      loadRecipesTable();
      loadFormData();
      
      // Görsel yükleme alanını başlat
      initOutfitImageUpload();
      
      // Buton event listener'ları
      el('#btnGoBack').addEventListener('click', function() {
        window.location.href = 'index.html';
      });
      
      el('#btnLogout').addEventListener('click', function() {
        localStorage.removeItem('adminSession');
        window.location.href = 'index.html';
      });
      
      // Film butonları
      el('#btnResetMovie').addEventListener('click', resetMovieForm);
      el('#btnSaveMovie').addEventListener('click', saveMovieData);
      
      // Dizi butonları
      el('#btnResetSeries').addEventListener('click', resetSeriesForm);
      el('#btnSaveSeries').addEventListener('click', saveSeriesData);
      
      // Kombin butonları
      el('#btnResetOutfit').addEventListener('click', resetOutfitForm);
      el('#btnSaveOutfit').addEventListener('click', saveOutfitData);
      
      // Tarif butonları
      el('#btnResetRecipe').addEventListener('click', resetRecipeForm);
      el('#btnNewRecipe').addEventListener('click', resetRecipeForm);
      el('#btnSaveRecipe').addEventListener('click', saveRecipe);
    });
  </script>
</body>
</html>
